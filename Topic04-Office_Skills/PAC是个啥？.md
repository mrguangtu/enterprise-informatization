



## PAC是个啥？

简单来说，就是**代理自动配置文件**。

我比较喜欢把缩写对应的全称找到，以便更准确的理解意思。PAC，英文是**Proxy Auto-Configuration (PAC) file**，是一个文件。下面是个看起来比较权威的网站：

[http://findproxyforurl.com/pac-file-introduction/](http://findproxyforurl.com/pac-file-introduction/)



## 为啥要搞个PAC出来，是干啥的？

**PAC文件**是使用JavaScript写的规则，允许Web浏览器确定是将Web流量直接发送到Internet还是通过代理服务器发送。PAC文件可以控制Web浏览器处理HTTP，HTTPS和FTP流量的方式。正是由于使用了JavaScript，所以是跨平台的。而且，不论是域名还是IP地址，都能正确自动路由流量。还能支持代理故障时自动转换。

所以，在没有PAC的时候，选择用或者不用代理，只能手工切换。但有了PAC，就可以把规则加上去，自动化的做判断。而这一组代码化了的规则，有一个更贴切的词，叫**策略**。有了策略，也就可以做到**更加灵活、健壮**。



## 具体咋弄？

[这里](http://findproxyforurl.com/pac-code-snippets-examples/)提供了 一些代码片段，有JavaScript经验的可以根据需要自己改一改，非常方便。



下面就着一个示例，讲一下PAC文件的构成。



···

// Generated by gfwlist2pac
// https://github.com/clowwindy/gfwlist2pac

var domains = {
  "facebook.com": 1, 
  "google.com": 1, 
  "twitter.com": 1}；

var proxy = "__PROXY__";

var direct = 'DIRECT;';

var hasOwnProperty = Object.hasOwnProperty;

function FindProxyForURL(url, host) {
    var suffix;
    var pos = host.lastIndexOf('.');
    pos = host.lastIndexOf('.', pos - 1);
    while(1) {
        if (pos <= 0) {
            if (hasOwnProperty.call(domains, host)) {
                return proxy;
            } else {
                return direct;
            }
        }
        suffix = host.substring(pos + 1);
        if (hasOwnProperty.call(domains, suffix)) {
            return proxy;
        }
        pos = host.lastIndexOf('.', pos - 1);
    }
}

···

1. PAC文件里不能包含任何HTML标签, 一定要定义的函数是**Function FindProxyForURL(url, host)**。url是要访问的完整网址路径，host是对方主机名。
2. 上面的示例代码的意思就是从一个列表里面找域名，找到了的就走代理，没找到的就直通。具体是，如果最上面一层的域名在domain的列表里，那么就用代理，否则找下一级子域名，看在不在domain的列表里，在的话也走代理。
3. 返回值总共有三种：Direct，Proxy，Socks。关于Socks，不同浏览器的解释是不同的，有Socks4和Socks5的区别。
4. PAC还专门提供了一些函数。由于标准化还不够健全，这些函数的兼容性很难保证，需要测试。



参考：

[https://www.cnblogs.com/milton/p/6263596.html](https://www.cnblogs.com/milton/p/6263596.html)
[https://www.cnblogs.com/andrewwang/p/9299087.html](https://www.cnblogs.com/andrewwang/p/9299087.html)